<div class="d-flex flex-column align-items-center w-100 position-relative">

  <!-- Search Header -->
  <div class="search-section w-100 text-center mt-5 mb-5" style="max-width: 720px; z-index: 2;">
    <h1 class="display-5 fw-bold mb-3" style="color: #202124;">Document Search Engine</h1>
    <p class="text-muted mb-4">Search indexed documents using intelligent ranking</p>

    <!-- Search Input -->
    <div class="google-search-bar shadow-sm">
      <span class="search-icon ps-3 pe-2 text-muted">üîç</span>

      <input type="text" 
             [(ngModel)]="query"
             class="flex-grow-1 border-0 bg-transparent"
             style="outline: none; font-size: 1.15rem;"
             placeholder="Search research papers, articles, reports..."
             (input)="onQueryChange()"
             (keyup.enter)="search()">
    </div>

    <!-- Search Button -->
    <div class="d-flex justify-content-center gap-3 mt-4">
      <button class="btn btn-primary px-4 fw-semibold" (click)="search()">
        Search Documents
      </button>
    </div>
  </div>

  <!-- Search Results -->
  <div *ngIf="results && results.length" class="results-container w-100" style="max-width: 720px;">
    
    <p class="text-muted small mb-4">
      {{ results.length }} matching documents found
    </p>

    <div *ngFor="let doc of results" 
         class="result-card mb-4 p-3 rounded hover-shadow"
         (click)="openModal(doc)">

      <div class="result-url text-muted small mb-1">
        Document ID ‚Ä∫ {{ doc.id || 'N/A' }}
      </div>

      <h3 class="result-title fw-semibold mb-1">{{ doc.title }}</h3>

      <p class="result-snippet text-secondary"
         [innerHTML]="highlightQuery(doc.contentSnippet)">
      </p>

      <span class="badge bg-light text-dark border mt-1">
        Relevance Score: {{ (doc.score * 100) | number:'1.0-1' }}%
      </span>
    </div>
  </div>

  <!-- No Results State -->
  <div *ngIf="hasSearched && results.length === 0" class="text-center text-muted mt-5">
    <p class="lead">
      No matching documents found for <strong>"{{ query }}"</strong>
    </p>
    <small>Try broader keywords or different phrasing.</small>
  </div>

</div>

<!-- Document Preview Modal -->
<div *ngIf="selectedDoc" class="modal-backdrop" (click)="closeModal()">

  <div class="modal-content shadow-lg rounded" (click)="$event.stopPropagation()">

    <!-- Modal Header -->
    <div class="modal-header d-flex justify-content-between align-items-start">
      <div>
        <h2 class="h5 fw-bold mb-1">{{ selectedDoc.title }}</h2>
        <small class="text-muted">
          Relevance Score: {{ (selectedDoc.score * 100) | number:'1.0-1' }}%
        </small>
      </div>

      <button class="btn-close-custom fs-4" (click)="closeModal()">√ó</button>
    </div>

    <!-- Modal Body -->
    <div class="modal-body">

      <div *ngIf="selectedDoc.loading" class="text-center text-muted py-5">
        Loading full document content...
      </div>

      <div *ngIf="!selectedDoc.loading"
           class="document-text lh-lg"
           [innerHTML]="highlightQuery(selectedDoc.content)">
      </div>

    </div>

    <!-- Modal Footer -->
    <div class="modal-footer d-flex justify-content-end">
      <button class="btn btn-outline-primary rounded-pill px-4" (click)="closeModal()">
        Close Preview
      </button>
    </div>

  </div>
</div>
